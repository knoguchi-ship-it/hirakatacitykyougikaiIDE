# 認証・権限仕様書

## 1. 目的
- 会員ログインと管理者ログインの方式を明確に分離し、判定ロジックの齟齬を防ぐ。
- 管理者が自分の会員マイページも利用できる要件を運用ルールとして固定する。

## 2. 認証方式
1. 会員ログイン
- 方式: `ログインID + パスワード`
- 使用テーブル: `T_認証アカウント`（`認証方式=PASSWORD`）
- Googleログインは使用しない。

2. 管理者ログイン
- 方式: Googleアカウント認証（IDトークン検証）
- 使用テーブル: `T_管理者Googleホワイトリスト`
- 許可条件:
  - Google主体（`GoogleユーザーID`）がホワイトリストに存在
  - `有効フラグ=true`
  - `紐付け認証ID` / `紐付け会員ID` が整合

## 3. 権限表示ルール
1. 会員マイページ種別
- 個人会員
- 事業所会員（管理者）
- 事業所会員（メンバー）

2. 左メニュー表示
- 会員ログイン: `会員マイページ` のみ
- 管理者ログイン: `会員マイページ` + `管理者ページ`

3. 管理者の会員情報紐付け
- 管理者アカウントにも必ず `会員ID` を紐付ける。
- 管理者ログイン中も、自分の会員情報を会員マイページで参照できる。

## 4. 会費・研修の表示仕様
1. 年会費
- 引き落とし機能は実装しない。
- 未納時のみ振込先口座を表示する。

2. 研修
- 受付中研修は `概要/詳細` を表示する。
- 案内文PDFを閲覧できるリンクを表示する。

## 5. 受け入れ基準（DoD）
1. 認証
- 会員ID/PWでログイン成功し、Googleログインなしで会員利用可能。
- ホワイトリスト外Googleアカウントは管理者ログイン不可。

2. 権限
- 管理者ログイン時のみ `管理者ページ` が左メニューに出る。
- 管理者ログイン時に `会員マイページ` も利用可能。

3. 監査
- `T_ログイン履歴` に `認証方式` が記録される。

4. 会費・研修
- 未納時のみ振込先表示が出る。
- 受付中研修の詳細とPDFが閲覧できる。
