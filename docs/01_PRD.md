# Product Requirements Document (PRD)

## 1. 目的と背景
枚方市介護支援専門員連絡協議会では、会員情報の管理や研修の案内・受付をアナログ（紙、郵送、FAX）で行っており、事務局の業務負荷が高い状態にあった。
本システムは、これらの業務をデジタル化・ペーパーレス化し、会員の利便性向上と事務局の業務効率化を実現する。

## 2. ターゲットユーザーと権限
システムは大きく分けて2つの権限（ロール）が存在する。

### 2.1 事務局（ADMIN）
- **役割**: 協議会の運営スタッフ。
- **機能要件**:
  - 全会員のデータ閲覧・検索・編集。
  - 研修の作成、申込状況の確認。
  - ダッシュボードでの統計情報（会員数、会費納入率など）の確認。
  - AIを用いた会員向け案内メールの文面生成。
  - 管理者ページへのアクセス（会員マイページとは別建て）。
  - 管理者ログイン中でも、自分に紐づく会員マイページを閲覧可能。

### 2.2 会員（MEMBER）
会員マイページの種別は以下3種類とする。

#### A. 個人会員
- ケアマネジャー個人として登録している会員。
- 自身のプロフィール情報の更新、研修への申込を行う。
- 連絡手段として「メール」または「郵送」を選択可能。

#### B. 事業所会員（管理者）
- 介護事業所として登録している会員。
- 1つの事業所アカウントの下に、複数の「職員（Staff）」が紐づく。
- 研修の申込は「事業所」としてではなく、「職員ごと」に行う。
- 郵送物は事業所宛に一括送付され、メールは各職員へ個別に配信される。
- 事業所情報・所属職員情報・発送設定の変更が可能。

#### C. 事業所会員（メンバー）
- 事業所会員のうち、閲覧中心権限を持つ職員。
- 事業所情報・所属職員情報・発送設定は閲覧のみ（自身の申込操作のみ可能）。
- どの画面項目を閲覧/変更できるかは、ロール別の項目権限定義に従う。

## 3. コアユースケース
1. **会員情報の自己更新**: 会員が引っ越しや転職をした際、システム上から自身で情報を更新できる。
2. **研修のワンクリック申込**: 案内された研修に対し、システム上からボタン一つで申込が完了する。
3. **会費納入状況の可視化**: 自身の年会費が納入済みか未納かをマイページで確認できる。未納時は振込先口座情報を表示する（引き落とし機能は持たない）。
4. **ペーパーレス移行の促進**: 郵送からメールへの切り替えをUI上で推奨し、通信費を削減する。
5. **会員認証情報の管理**: ログインIDは表示のみ、パスワードは「現在のパスワード + 新しいパスワード」で変更可能。
6. **研修詳細とPDF案内の閲覧**: 受付中研修の詳細本文と案内PDFを会員が閲覧できる。

## 4. システム要件・制約事項（プラットフォーム）
本システムは、NPO法人等の非営利団体向けに提供される **Google Workspace for Nonprofits (GWNP)** の標準機能を最大限に活用し、**追加のランニングコスト（レンタルサーバー代やクラウドDB利用料等）をゼロに抑える** ことを絶対条件とする。

- **インフラ/ホスティング**: 外部のレンタルサーバーは使用せず、Google Apps Script (GAS) のWebアプリ機能（HTML Service）を利用してフロントエンドを配信する。
- **データベース**: Google スプレッドシートをデータベースとして利用する。
- **バックエンド**: GASをAPIサーバーとして利用し、スプレッドシートの読み書きを行う。
- **メール配信**: GWNPのGmailインフラ（GASの `GmailApp`）を利用し、高い送信上限枠を活用して一斉送信や自動通知を行う。
- **認証**:
  - 会員: `ログインID + パスワード` 認証のみ（Googleログインは使用しない）。
  - 管理者: Googleアカウント認証 + ホワイトリスト照合。
- **開発仕様の絶対ルール**: Google AI Studio と本プロジェクトの開発構成を常に同期し、**Google AI Studio の Build Preview でモックアップが表示できる状態を維持すること**（`build:preview` と `VITE_USE_MOCK=true` を前提運用とする）。
- **認証の絶対条件**: 本システムの全アクセス制御は、ログインIDとパスワード認証に紐づく認証アカウントを基準に判定する。パスワード平文は保持せず、ハッシュ化された値のみを保存する。

## 5. 受け入れ指標（DoD/KPI）
1. 認証成功率: 正常な会員ID/パスワード入力時のログイン成功率 99.9%以上（障害時除外）。
2. 不正ログイン抑止: 無効資格情報で管理者ページへ到達できないこと（ホワイトリスト外は常に拒否）。
3. 会員ページ種別表示: 3種類（個人/事業所管理者/事業所メンバー）がUI上で識別表示されること。
4. 管理者導線: 管理者ログイン時のみ左メニューに `管理者ページ` が表示されること。
5. 会費表示要件: 未納時に振込先口座が表示され、納入済時は表示されないこと。
6. パスワード変更要件: 現在PW不一致時は変更不可、成功時は `パスワード更新日時` が更新されること。
7. 研修表示要件: 受付中研修で「詳細」と「案内PDF」が表示・遷移できること。
